<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Brainrot Upgrade ‚Äî Mutation Wipe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fffaf3;
      color: #333;
      margin: 0;
      padding: 0;
      text-align: center;
      overflow-x: hidden;
    }

    h1 {
      font-size: 42px;
      color: #d35400;
      margin: 20px 0 0;
    }

    #subtitle {
      font-size: 20px;
      color: #f1c40f;
      margin-bottom: 20px;
      font-weight: bold;
    }

    #balance {
      font-size: 22px;
      font-weight: bold;
      color: #27ae60;
      margin-bottom: 10px;
    }

    #active-events {
      margin-bottom: 20px;
    }

    #active-events h3 {
      margin: 0;
      font-size: 18px;
      color: #e67e22;
    }

    #event-status span {
      margin: 0 6px;
      font-weight: bold;
      font-size: 16px;
    }

    #event-timers {
      font-size: 16px;
      margin-bottom: 20px;
    }

    .event-timer {
      margin: 4px 0;
      color: #c0392b;
    }

    #fullscreen-event {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.7);
      color: #fff;
      font-size: 48px;
      font-weight: bold;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    #taco-rain {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      overflow: hidden;
      z-index: 9998;
    }

    .taco {
      position: absolute;
      font-size: 32px;
      animation: fall 3s linear infinite;
    }

    @keyframes fall {
      0% { top: -50px; opacity: 1; }
      100% { top: 100vh; opacity: 0; }
    }

    button {
      padding: 8px 16px;
      margin: 6px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      transform: scale(1.05);
    }

    .action-button {
      background: linear-gradient(to right, #f39c12, #e67e22);
      color: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .sell-button {
      background: linear-gradient(to right, #e74c3c, #c0392b);
    }

    .collect-button {
      background: linear-gradient(to right, #2ecc71, #27ae60);
    }

    .slot {
      border: 2px solid #ddd;
      border-radius: 12px;
      padding: 12px;
      margin: 8px;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    #conveyor {
      position: relative;
      height: 160px;
      overflow: hidden;
      margin: 20px auto;
      width: 100%;
      max-width: 400px;
      border: 2px dashed #ccc;
      border-radius: 12px;
      background: #fefefe;
    }

    .unit {
      position: absolute;
      left: -100%;
      width: 100%;
      padding: 16px;
      box-sizing: border-box;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      animation: slideInSlow 7s linear forwards;
    }

    @keyframes slideInSlow {
      0% { left: -100%; opacity: 0; }
      10% { opacity: 1; }
      50% { left: 0%; }
      90% { opacity: 1; }
      100% { left: 100%; opacity: 0; }
    }
  </style>
</head>
<body>

<h1>üß† Brainrot Upgrade</h1>
<div id="subtitle">Mutation Edition ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π –≤–∞–π–ø –∏ –Ω–æ–≤—ã–π —Å—Ç–∞—Ä—Ç</div>

<div id="balance">–ë–∞–ª–∞–Ω—Å: ‚ÇΩ0</div>

<div id="active-events">
  <h3>‚ö° –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:</h3>
  <div id="event-status">
    <span id="fire-status">üî• Fire: OFF</span> |
    <span id="brainrot-status">üß† Time Brainrot: OFF</span> |
    <span id="taco-status">üåÆ Taco: OFF</span> |
    <span id="halloween-status">üéÉ Halloween: OFF</span>
  </div>
</div>

<div id="event-timers">
  <div class="event-timer">üî• Fire Event —á–µ—Ä–µ–∑ <span id="fire-timer">450</span> —Å–µ–∫</div>
  <div class="event-timer">üß† Time Brainrot —á–µ—Ä–µ–∑ <span id="brainrot-timer">400</span> —Å–µ–∫</div>
  <div class="event-timer">üåÆ Taco Event —á–µ—Ä–µ–∑ <span id="taco-timer">800</span> —Å–µ–∫</div>
  <div class="event-timer">üéÉ Halloween Event —á–µ—Ä–µ–∑ <span id="halloween-timer">1500</span> —Å–µ–∫</div>
</div>

<div id="fullscreen-event"></div>
<div id="taco-rain"></div>

<script>
// üí£ –ì–ª–æ–±–∞–ª—å–Ω—ã–π –≤–∞–π–ø: —É–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã –∏ —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π localStorage
if (!localStorage.getItem("brainrotWipe_v6")) {
  localStorage.clear();
  localStorage.setItem("brainrotWipe_v6", "true");
}

// üí¨ –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ —á–∏—Å–µ–ª: 1500 ‚Üí 1.5K, 1500000 ‚Üí 1.5M, 1500000000 ‚Üí 1.5B
function formatMoney(value) {
  if (value >= 1e9) return (value / 1e9).toFixed(1) + "B";
  if (value >= 1e6) return (value / 1e6).toFixed(1) + "M";
  if (value >= 1e3) return (value / 1e3).toFixed(1) + "K";
  return Math.floor(value);
}
</script>
<!-- üöÄ –ë–∞–∑–∞ -->
<h2>üöÄ –ë–∞–∑–∞ (<span id="slot-count">8</span> —Å–ª–æ—Ç–æ–≤)</h2>
<div id="base" style="display:flex; flex-wrap:wrap; justify-content:center; gap:12px;"></div>

<!-- üì¶ –ö–æ–Ω–≤–µ–π–µ—Ä -->
<h2>üì¶ –ö–æ–Ω–≤–µ–π–µ—Ä</h2>
<div id="conveyor" style="margin-bottom:20px;"></div>

<!-- ‚ùó –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏ -->
<div id="sell-confirm-overlay" style="display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.6);
  z-index:9998;"></div>

<div id="sell-confirm-popup" style="display:none;
  position:fixed;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  background:#fff;
  padding:30px;
  border-radius:16px;
  box-shadow:0 0 20px rgba(0,0,0,0.4);
  z-index:9999;
  max-width:400px;
  text-align:center;">
  <h3>‚ùó –í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–∞—Ç—å –±—Ä–µ–π–Ω—Ä–æ—Ç–∞?</h3>
  <div id="sell-unit-name" style="font-size:20px; font-weight:bold; margin:10px 0;"></div>
  <button class="action-button sell-button" onclick="confirmSell()">‚úÖ –ü—Ä–æ–¥–∞—Ç—å</button>
  <button class="action-button collect-button" onclick="cancelSell()">‚ùå –û—Ç–º–µ–Ω–∞</button>
</div>

<!-- üõ† Admin Panel -->
<h2>üõ† Admin Panel</h2>
<div id="admin-panel">
  <input type="password" id="admin-password" placeholder="–ü–∞—Ä–æ–ª—å" style="padding:6px; border-radius:6px;">
  <button class="action-button" onclick="unlockAdmin()">–í–æ–π—Ç–∏</button>
  <div id="admin-controls" style="display:none;">
    <div class="admin-section">
      <h3>üé≤ –°–ø–∞–≤–Ω –±—Ä–µ–π–Ω—Ä–æ—Ç–∞</h3>
      <select id="custom-unit-name">
        <option>Br Br Patapim</option>
        <option>Bandito Bobrito</option>
        <option>Bombandiro Crocodilo</option>
        <option>Cocofanto Elefanto</option>
        <option>Te Te Sahur</option>
        <option>Tralalelo Tralala</option>
        <option>Matteo</option>
        <option>Mythico Dragono</option>
        <option>Tung Tung Sahur</option>
        <option>Spaghetti Toileti</option>
        <option>Los Tungtungtunos</option>
        <option>Los Combinasion</option>
        <option>Lili Lalira</option>
        <option>Svinino Bombandiro</option>
        <option>La Vacca Saturno Saturnita</option>
        <option>Zebra Tacos</option>
        <option>Taco Gav</option>
        <option>Orcalelo Orcalala</option>
        <option>Toxic Zombie</option>
      </select><br>
      <button class="action-button" onclick="spawnCustomUnit()">–°–ø–∞–≤–Ω</button>
    </div>
    <div class="admin-section">
      <h3>üî• –ó–∞–ø—É—Å–∫ –∏–≤–µ–Ω—Ç–∞</h3>
      <button class="action-button" onclick="startFireEvent()">Fire</button>
      <button class="action-button" onclick="startTimeBrainrotEvent()">Time Brainrot</button>
      <button class="action-button" onclick="startTacoEvent()">Taco</button>
      <button class="action-button" onclick="startHalloweenEvent()">Halloween</button>
    </div>
    <div class="admin-section">
      <h3>üîÅ –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ</h3>
      <button class="action-button" onclick="tryRebirth()">–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ</button>
    </div>
    <div class="admin-section">
      <h3>üßπ –†—É—á–Ω–æ–π –≤–∞–π–ø</h3>
      <button class="action-button" onclick="manualWipe()">–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
    </div>
  </div>
</div>

<script>
function manualWipe() {
  if (confirm("–í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å?")) {
    localStorage.clear();
    location.reload();
  }
}
</script>
<script>
let balance = 200;
let rebirthLevel = 0;
let baseSlots = Array(8).fill(null);

let fireTimer = 450;
let brainrotTimer = 400;
let tacoTimer = 800;
let halloweenTimer = 1500;

let fireActive = false;
let timeBrainrotActive = false;
let tacoActive = false;
let halloweenActive = false;
let tacoUnitCounter = 0;
let totalTacoUnits = 0;
let toxicZombieSpawned = false;

let adminUnlocked = false;

function updateBalanceDisplay() {
  document.getElementById("balance").innerText = `–ë–∞–ª–∞–Ω—Å: ‚ÇΩ${formatMoney(balance)}`;
}

function showFullscreenEvent(text) {
  const div = document.getElementById("fullscreen-event");
  div.innerText = text;
  div.style.display = "flex";
  setTimeout(() => {
    div.style.display = "none";
  }, 2000);
}

function startFireEvent() {
  fireActive = true;
  showFullscreenEvent("üî• Fire Event –∞–∫—Ç–∏–≤–µ–Ω!");
  setTimeout(() => fireActive = false, 30000);
}

function startTimeBrainrotEvent() {
  timeBrainrotActive = true;
  showFullscreenEvent("üß† Time Brainrot –∞–∫—Ç–∏–≤–µ–Ω!");
  setTimeout(() => timeBrainrotActive = false, 30000);
}

function startTacoEvent() {
  tacoActive = true;
  tacoUnitCounter = 0;
  totalTacoUnits = 0;
  showFullscreenEvent("üåÆ Taco Event –∞–∫—Ç–∏–≤–µ–Ω!");
  startTacoRain();
  setTimeout(() => {
    tacoActive = false;
    stopTacoRain();
  }, 40000);
}

function startHalloweenEvent() {
  halloweenActive = true;
  showFullscreenEvent("üéÉ Halloween Event –∞–∫—Ç–∏–≤–µ–Ω!");
  toxicZombieSpawned = false;
  setTimeout(() => halloweenActive = false, 60000);
}

function updateEventTimers() {
  document.getElementById("fire-timer").innerText = fireTimer;
  document.getElementById("brainrot-timer").innerText = brainrotTimer;
  document.getElementById("taco-timer").innerText = tacoTimer;
  document.getElementById("halloween-timer").innerText = halloweenTimer;
}

function updateEventStatus() {
  document.getElementById("fire-status").innerText = `üî• Fire: ${fireActive ? "ON" : "OFF"}`;
  document.getElementById("brainrot-status").innerText = `üß† Time Brainrot: ${timeBrainrotActive ? "ON" : "OFF"}`;
  document.getElementById("taco-status").innerText = `üåÆ Taco: ${tacoActive ? "ON" : "OFF"}`;
  document.getElementById("halloween-status").innerText = `üéÉ Halloween: ${halloweenActive ? "ON" : "OFF"}`;
}

setInterval(() => {
  fireTimer--;
  brainrotTimer--;
  tacoTimer--;
  halloweenTimer--;

  if (fireTimer <= 0) {
    startFireEvent();
    fireTimer = 450;
  }
  if (brainrotTimer <= 0) {
    startTimeBrainrotEvent();
    brainrotTimer = 400;
  }
  if (tacoTimer <= 0) {
    startTacoEvent();
    tacoTimer = 800;
  }
  if (halloweenTimer <= 0) {
    startHalloweenEvent();
    halloweenTimer = 1500;
  }

  updateEventTimers();
  updateEventStatus();
}, 1000);

function unlockAdmin() {
  const pass = document.getElementById("admin-password").value;
  if (pass === "brainrot123") {
    adminUnlocked = true;
    document.getElementById("admin-controls").style.display = "block";
    showFullscreenEvent("üõ† Admin Panel –∞–∫—Ç–∏–≤–Ω–∞");
  } else {
    alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
  }
}

function tryRebirth() {
  const totalIncome = baseSlots.reduce((sum, unit) => sum + (unit?.income || 0), 0);
  if (totalIncome < 1000) {
    alert("–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 1000 –æ–±—â–µ–≥–æ –¥–æ—Ö–æ–¥–∞ –¥–ª—è –ø–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è!");
    return;
  }

  if (!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ—Ä–æ–¥–∏—Ç—å—Å—è? –í—Å–µ —é–Ω–∏—Ç—ã –±—É–¥—É—Ç —Å–±—Ä–æ—à–µ–Ω—ã.")) return;

  rebirthLevel++;
  baseSlots = Array(8 + rebirthLevel * 2).fill(null);
  balance = 200 + rebirthLevel * 100;
  saveGame();
  updateBalanceDisplay();
  updateBaseDisplay();
  updateSlotCount();
  showFullscreenEvent(`üîÅ –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ ${rebirthLevel} —É—Ä–æ–≤–Ω—è!`);
}

// üåÆ Taco Rain
let tacoRainInterval = null;

function startTacoRain() {
  const rainContainer = document.getElementById("taco-rain");
  tacoRainInterval = setInterval(() => {
    const taco = document.createElement("div");
    taco.className = "taco";
    taco.style.left = Math.random() * 100 + "vw";
    taco.innerText = "üåÆ";
    rainContainer.appendChild(taco);
    setTimeout(() => taco.remove(), 3000);
  }, 200);
}

function stopTacoRain() {
  clearInterval(tacoRainInterval);
}

// üí• –ú—É—Ç–∞—Ü–∏–∏ —Å –∏–∫—Å–∞–º–∏
function applyMutations(unit) {
  let multiplier = 1;
  let mutations = [];

  if (fireActive && Math.random() < 0.8) {
    mutations.push("üî• Fire");
    multiplier *= 2;
  }

  if (tacoActive && Math.random() < 0.5) {
    mutations.push("üåÆ Taco");
    multiplier *= 2;
  }

  if (halloweenActive && !toxicZombieSpawned) {
    unit.name = "Toxic Zombie";
    unit.income = 180;
    unit.cost = 30000;
    unit.mutation = "‚ò£Ô∏è Toxic";
    toxicZombieSpawned = true;
    return unit;
  }

  if (halloweenActive && Math.random() < 0.2) {
    mutations.push("üéÉ Halloween");
    multiplier *= 3;
  }

  if (mutations.length > 0) {
    unit.mutation = mutations.join(" + ");
    unit.income *= multiplier;
  }

  return unit;
}
</script>
  <script>
function updateBaseDisplay() {
  const baseDiv = document.getElementById("base");
  baseDiv.innerHTML = "";
  baseSlots.forEach((unit, i) => {
    const div = document.createElement("div");
    div.className = "slot";
    if (unit) {
      let multiplier = timeBrainrotActive ? 1.5 : 1;
      let incomeDisplay = `‚ÇΩ${formatMoney(unit.income * multiplier)}/—Å–µ–∫`;
      let bonusText = timeBrainrotActive ? "<span style='color:#27ae60;'>√ó1.5 –±–æ–Ω—É—Å</span><br>" : "";
      let mutationText = unit.mutation ? `<span style='color:#e74c3c;'>${unit.mutation}</span><br>` : "";

      if (unit.name === "Lucky Block") {
        div.innerHTML = `<strong>üéÅ Lucky Block</strong><br>
          <span style="font-size:16px;">–û—Ç–∫—Ä—ã—Ç—å –¥–ª—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –±—Ä–µ–π–Ω—Ä–æ—Ç–∞</span><br><br>
          <button class="action-button" onclick="openLuckyBlock(${i})">–û—Ç–∫—Ä—ã—Ç—å</button>`;
      } else {
        div.innerHTML = `<strong>${unit.name}</strong><br>
          ${mutationText}${bonusText}${incomeDisplay}<br>
          –ö–æ–ø–∏–ª–∫–∞: ‚ÇΩ${formatMoney(unit.stash || 0)}<br>
          <button class="action-button collect-button" onclick="collect(${i})">–ó–∞–±—Ä–∞—Ç—å</button>
          <button class="action-button sell-button" onclick="sellUnit(${i})">–ü—Ä–æ–¥–∞—Ç—å</button>`;
      }
    } else {
      div.innerText = "–ü—É—Å—Ç–æ";
    }
    baseDiv.appendChild(div);
  });
}

setInterval(() => {
  baseSlots.forEach(unit => {
    if (unit && unit.name !== "Lucky Block") {
      const multiplier = timeBrainrotActive ? 1.5 : 1;
      unit.stash = (unit.stash || 0) + unit.income * multiplier;
    }
  });
  updateBaseDisplay();
}, 1000);

function updateSlotCount() {
  document.getElementById("slot-count").innerText = baseSlots.length;
}

function saveGame() {
  localStorage.setItem("brainrotSave", JSON.stringify({
    balance,
    baseSlots,
    rebirthLevel
  }));
}

function loadGame() {
  const save = localStorage.getItem("brainrotSave");
  if (save) {
    const data = JSON.parse(save);
    balance = data.balance || 200;
    baseSlots = data.baseSlots || Array(8).fill(null);
    rebirthLevel = data.rebirthLevel || 0;
  }
}

function collect(index) {
  const unit = baseSlots[index];
  if (!unit || unit.name === "Lucky Block") return;
  balance += unit.stash || 0;
  unit.stash = 0;
  updateBalanceDisplay();
  updateBaseDisplay();
  saveGame();
}

function sellUnit(index) {
  const unit = baseSlots[index];
  if (!unit) return;
  document.getElementById("sell-unit-name").innerText = unit.name;
  document.getElementById("sell-confirm-overlay").style.display = "block";
  document.getElementById("sell-confirm-popup").style.display = "block";
  window.pendingSellIndex = index;
}

function confirmSell() {
  const index = window.pendingSellIndex;
  const unit = baseSlots[index];
  if (!unit) return;
  if (unit.name !== "Lucky Block") {
    balance += Math.floor(unit.cost * 0.5);
  }
  baseSlots[index] = null;
  updateBalanceDisplay();
  updateBaseDisplay();
  updateSlotCount();
  saveGame();
  cancelSell();
}

function cancelSell() {
  document.getElementById("sell-confirm-overlay").style.display = "none";
  document.getElementById("sell-confirm-popup").style.display = "none";
  window.pendingSellIndex = null;
}

// üéÅ –û—Ç–∫—Ä—ã—Ç–∏–µ Lucky Block –Ω–∞ –±–∞–∑–µ
function openLuckyBlock(index) {
  const unit = baseSlots[index];
  if (!unit || unit.name !== "Lucky Block") return;

  baseSlots[index] = {
    name: "‚ùì‚ùì‚ùì",
    income: 0,
    cost: 0,
    stash: 0
  };
  updateBaseDisplay();

  setTimeout(() => {
    const roll = Math.random();
    let name = "Bandito Bobrito";
    if (roll < 0.03) name = "Spaghetti Toileti";
    else if (roll < 0.18) name = "Los Combinasion";
    else if (roll < 0.20) name = "Los Tungtungtunos";
    else if (roll < 0.65) name = "Orcalelo Orcalala";

    const base = units[name];
    baseSlots[index] = applyMutations({
      name,
      income: base.income,
      cost: base.cost,
      stash: 0
    });

    showFullscreenEvent(`üéÅ Lucky Block: ${name}`);
    updateBaseDisplay();
    updateSlotCount();
    saveGame();
  }, 1000);
}
  </script>
<script>
let conveyorBusy = false;
let currentUnit = null;

const units = {
  "Br Br Patapim":        { income: 10, cost: 100, chance: 0.40 },
  "Bandito Bobrito":      { income: 25, cost: 2700, chance: 0.40 },
  "Bombandiro Crocodilo": { income: 20, cost: 700, chance: 0.40 },
  "Cocofanto Elefanto":   { income: 50, cost: 4000, chance: 0.35 },
  "Te Te Sahur":          { income: 40, cost: 3000, chance: 0.35 },
  "Tralalelo Tralala":    { income: 500, cost: 150000, chance: 0.20 },
  "Matteo":               { income: 120, cost: 20000, chance: 0.30 },
  "Mythico Dragono":      { income: 100, cost: 15000, chance: 0.25 },
  "Tung Tung Sahur":      { income: 2000, cost: 1200000, chance: 0.15 },
  "Spaghetti Toileti":    { income: 150, cost: 25000, chance: 0.03 },
  "Los Tungtungtunos":    { income: 3000, cost: 50000, chance: 0.02 },
  "Los Combinasion":      { income: 6000, cost: 100000, chance: 0.01 },
  "Lili Lalira":          { income: 20, cost: 500, chance: 0.35 },
  "Svinino Bombandiro":   { income: 20, cost: 500, chance: 0.35 },
  "La Vacca Saturno Saturnita": { income: 5000000, cost: 300000000, chance: 0 },
  "Zebra Tacos":          { income: 60, cost: 5000, chance: 0 },
  "Taco Gav":             { income: 90, cost: 11000, chance: 0 },
  "Orcalelo Orcalala":    { income: 70, cost: 8000, chance: 0 },
  "Toxic Zombie":         { income: 180, cost: 30000, chance: 0 }
};

function rollConveyorUnit() {
  if (conveyorBusy) return;
  conveyorBusy = true;

  if (Math.random() < 0.15) {
    renderLuckyBlock();
    return;
  }

  let selected = null;

  if (tacoActive) {
    totalTacoUnits++;
    if (totalTacoUnits % 15 === 0) selected = "Taco Gav";
    else if (totalTacoUnits % 5 === 0) selected = "Zebra Tacos";
  }

  if (!selected) {
    let roll = Math.random();
    for (let name in units) {
      const unit = units[name];
      if (unit.chance && roll <= unit.chance) {
        selected = name;
        break;
      }
      roll -= unit.chance || 0;
    }
  }

  if (!selected) selected = "Br Br Patapim";
  const base = units[selected];

  let unit = {
    name: selected,
    income: base.income,
    cost: base.cost,
    stash: 0
  };

  unit = applyMutations(unit);
  renderConveyorUnit(unit);
}

function renderConveyorUnit(unit) {
  currentUnit = unit;
  const conveyorDiv = document.getElementById("conveyor");
  conveyorDiv.innerHTML = "";

  const div = document.createElement("div");
  div.className = "unit";
  const mutationText = unit.mutation ? `<span style='color:#e74c3c;'>${unit.mutation}</span><br>` : "";

  div.innerHTML = `
    <strong style="font-size:18px;">${unit.name}</strong><br>
    ${mutationText}
    <span style="font-size:16px;">‚ÇΩ${formatMoney(unit.income)}/—Å–µ–∫</span><br>
    <span style="color:#999;">–¶–µ–Ω–∞: ‚ÇΩ${formatMoney(unit.cost)}</span><br><br>
    <button class="action-button" onclick='buyUnit()'>–ö—É–ø–∏—Ç—å</button>
  `;

  conveyorDiv.appendChild(div);

  setTimeout(() => {
    if (conveyorDiv.contains(div)) {
      conveyorDiv.innerHTML = "";
      conveyorBusy = false;
      rollConveyorUnit();
    }
  }, 7000);
}

function renderLuckyBlock() {
  currentUnit = { name: "Lucky Block", cost: 500000 };
  const conveyorDiv = document.getElementById("conveyor");
  conveyorDiv.innerHTML = "";

  const div = document.createElement("div");
  div.className = "unit";
  div.innerHTML = `
    <strong style="font-size:18px;">üéÅ Lucky Block</strong><br>
    <span style="font-size:16px;">–°–ª—É—á–∞–π–Ω—ã–π –±—Ä–µ–π–Ω—Ä–æ—Ç</span><br>
    <span style="color:#999;">–¶–µ–Ω–∞: ‚ÇΩ${formatMoney(500000)}</span><br><br>
    <button class="action-button" onclick='buyLuckyBlock()'>–û—Ç–∫—Ä—ã—Ç—å</button>
  `;

  conveyorDiv.appendChild(div);

  setTimeout(() => {
    if (conveyorDiv.contains(div)) {
      conveyorDiv.innerHTML = "";
      conveyorBusy = false;
      rollConveyorUnit();
    }
  }, 7000);
}

function buyUnit() {
  const unit = currentUnit;
  if (!unit) return;

  const emptyIndex = baseSlots.findIndex(slot => slot === null);
  if (emptyIndex === -1) return alert("–ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤!");
  if (balance < unit.cost) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!");

  balance -= unit.cost;
  baseSlots[emptyIndex] = unit;

  updateBalanceDisplay();
  updateBaseDisplay();
  updateSlotCount();
  saveGame();

  document.getElementById("conveyor").innerHTML = "";
  conveyorBusy = false;
  currentUnit = null;

  rollConveyorUnit();
}

function buyLuckyBlock() {
  if (balance < 500000) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!");
  const emptyIndex = baseSlots.findIndex(slot => slot === null);
  if (emptyIndex === -1) return alert("–ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤!");

  balance -= 500000;
  baseSlots[emptyIndex] = {
    name: "Lucky Block",
    income: 0,
    cost: 500000,
    stash: 0
  };

  updateBalanceDisplay();
  updateBaseDisplay();
  updateSlotCount();
  saveGame();

  document.getElementById("conveyor").innerHTML = "";
  conveyorBusy = false;
  currentUnit = null;

  rollConveyorUnit();
}

function spawnCustomUnit() {
  if (!adminUnlocked) return alert("–ù—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω–∫–µ!");
  const name = document.getElementById("custom-unit-name").value;
  const base = units[name];
  if (!base) return;

  let unit = {
    name,
    income: base.income,
    cost: base.cost,
    stash: 0
  };

  unit = applyMutations(unit);

  const emptyIndex = baseSlots.findIndex(slot => slot === null);
  if (emptyIndex === -1) return alert("–ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤!");

  baseSlots[emptyIndex] = unit;
  updateBaseDisplay();
  updateSlotCount();
  saveGame();
  showFullscreenEvent(`üß† –°–ø–∞–≤–Ω: ${unit.name}`);
}

// –∑–∞–ø—É—Å–∫
loadGame();
updateBalanceDisplay();
updateBaseDisplay();
updateSlotCount();
updateEventTimers();
updateEventStatus();
rollConveyorUnit();
</script>
</body>
</html>
